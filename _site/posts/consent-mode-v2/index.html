<!doctype html>













<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="" 
  
>
  <!-- The Head -->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover">

    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://trakker.gunnargriese.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-KCQ9XXH');
    </script>
    <!-- End Google Tag Manager -->
    <!-- Google Tag Manager - GA4 Lite Tester 
        
    <script id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="09a47599-0e16-4560-84a1-0163e0c147ea" type="text/javascript" async></script>

    

    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-PZV75QZ');
    </script>
    End Google Tag Manager -->

           <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Consent Mode v2 - A Comprehensive Technical Guide" />
<meta name="author" content="Gunnar Griese" />
<meta property="og:locale" content="en" />
<meta name="description" content="In fall 2023, the EU has deemed Google as a gatekeeper in the digital space under the Digital Markets Act (DMA), placing it under heightened legal scrutiny. In response to this assessment and to meet the DMA enforcement deadline in March 2024, Google is adjusting its advertising solutions. One aspect of this change is the latest update to Google Consent Mode. Starting in March 2024, Consent Mode will become mandatory for all advertisers operating in the EEA and wanting to use all of Google’s GMP advertising features. This shift, which includes phasing out certain features in the remaining UA360 properties while at the same time providing insufficient documentation on the new feature’s functionality and behavior, left the community with a lot of open questions." />
<meta property="og:description" content="In fall 2023, the EU has deemed Google as a gatekeeper in the digital space under the Digital Markets Act (DMA), placing it under heightened legal scrutiny. In response to this assessment and to meet the DMA enforcement deadline in March 2024, Google is adjusting its advertising solutions. One aspect of this change is the latest update to Google Consent Mode. Starting in March 2024, Consent Mode will become mandatory for all advertisers operating in the EEA and wanting to use all of Google’s GMP advertising features. This shift, which includes phasing out certain features in the remaining UA360 properties while at the same time providing insufficient documentation on the new feature’s functionality and behavior, left the community with a lot of open questions." />
<link rel="canonical" href="http://localhost:4000/gunnargriese.github.io/posts/consent-mode-v2/" />
<meta property="og:url" content="http://localhost:4000/gunnargriese.github.io/posts/consent-mode-v2/" />
<meta property="og:site_name" content="Gunnar Griese" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-30T23:00:01+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Consent Mode v2 - A Comprehensive Technical Guide" />
<meta name="twitter:site" content="@GeezerGunner" />
<meta name="twitter:creator" content="@Gunnar Griese" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Gunnar Griese","url":"https://gunnargriese.com"},"dateModified":"2024-01-30T23:00:01+01:00","datePublished":"2024-01-30T23:00:01+01:00","description":"In fall 2023, the EU has deemed Google as a gatekeeper in the digital space under the Digital Markets Act (DMA), placing it under heightened legal scrutiny. In response to this assessment and to meet the DMA enforcement deadline in March 2024, Google is adjusting its advertising solutions. One aspect of this change is the latest update to Google Consent Mode. Starting in March 2024, Consent Mode will become mandatory for all advertisers operating in the EEA and wanting to use all of Google’s GMP advertising features. This shift, which includes phasing out certain features in the remaining UA360 properties while at the same time providing insufficient documentation on the new feature’s functionality and behavior, left the community with a lot of open questions.","headline":"Consent Mode v2 - A Comprehensive Technical Guide","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/gunnargriese.github.io/posts/consent-mode-v2/"},"url":"http://localhost:4000/gunnargriese.github.io/posts/consent-mode-v2/"}</script>
<!-- End Jekyll SEO tag -->
 

    <title>Consent Mode v2 - A Comprehensive Technical Guide | Gunnar Griese
    </title>

    <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/gunnargriese.github.io/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/gunnargriese.github.io/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/gunnargriese.github.io/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/gunnargriese.github.io/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/gunnargriese.github.io/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Gunnar Griese">
<meta name="application-name" content="Gunnar Griese">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/gunnargriese.github.io/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
  
    <link rel="preconnect" href="https://fonts.googleapis.com" >
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" > 
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin> 
    <link rel="preconnect" href="https://fonts.googleapis.com" >
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" > 
    <link rel="preconnect" href="https://cdn.jsdelivr.net" >
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" > 

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"> 

    <!-- GA -->
    

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css">

    <link rel="stylesheet" href="/gunnargriese.github.io/assets/css/style.css"> 
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css">  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> 

    <!-- JavaScript -->

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script>

     <!--
  Switch the mode between dark and light.
-->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get MODE_ATTR() { return "data-mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }
    static get ID() { return "mode-toggle"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage({
        direction: ModeToggle.ID,
        message: this.modeStatus
      }, "*");
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle = new ModeToggle();
</script>
  <!-- A placeholder to allow defining custom metadata -->


    <!-- Page Metadata for DL -->
    <script>
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
            event: 'page_view',
            page_meta: {
                layout: 'post',
                page_title: document.title,
                page_location: document.URL,
                published_at: '2024-01-30T23:00:01+01:00',
            },
            author: {
                name: 'gunnar',
                url: '',
            },
            environment: 'development',
        })
    </script>
    <!-- End Page Metadata for DL -->

</head>

  <body data-topbar-visible="true">
    <!-- The Side Bar -->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/gunnargriese.github.io/" class="mx-auto">
        
          
          <img src="/gunnargriese.github.io/assets/img/avatar/gunnar-speaking-resized.jpg" alt="avatar" onerror="this.style.display='none'">
        
      </a>
    </div>

    <div class="site-title">
      <a href="/gunnargriese.github.io/">Gunnar Griese</a>
    </div>
    <div class="site-subtitle font-italic">Self-employed analytics consultant & tech enthusiast.</div>
  </div>
  <!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/gunnargriese.github.io/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
      <li class="nav-item">
        <a href="/gunnargriese.github.io/services/" class="nav-link">
          <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
          

          <span>SERVICES</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/gunnargriese.github.io/about/" class="nav-link">
          <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i>
          

          <span>ABOUT</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/gunnargriese.github.io/tools/" class="nav-link">
          <i class="fa-fw fas fa-tools ml-xl-3 mr-xl-3 unloaded"></i>
          

          <span>TOOLS</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/gunnargriese.github.io/categories/" class="nav-link">
          <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
          

          <span>CATEGORIES</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/gunnargriese.github.io/tags/" class="nav-link">
          <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i>
          

          <span>TAGS</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/gunnargriese.github.io/archives/" class="nav-link">
          <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
          

          <span>ARCHIVES</span>
        </a>
      </li>
      <!-- .nav-item -->
    
  </ul>
  <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center">
    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/GunnarGriese"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/GeezerGunner"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['gunnar.griese.gg','gmail.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="https://www.linkedin.com/in/gunnar-griese/"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</div>
<!-- #sidebar -->


    <!-- The Top Bar -->

<div id="topbar-wrapper">
  <div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4">
    <span id="breadcrumb">
      

      
        
          
            <span>
              <a href="/gunnargriese.github.io/">
                Home
              </a>
            </span>

          
        
          
        
          
            
              <span>Consent Mode v2 - A Comprehensive Technical Guide</span>
            

          
        
      
    </span>
    <!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </span>
    <span id="search-cancel">Cancel</span>
  </div>
</div>


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container pl-xl-4 pr-xl-4">
        









<div class="row">
  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4">
    <div class="post pl-1 pr-1 pl-md-2 pr-md-2">
      

      
        
      
        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      

    
      

      
      
      

      

    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    <!-- make sure the `<img>` is wrapped by `<a>` -->
    

    
      <!-- create the image wrapper -->
      
    

    <!-- combine -->
    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  




<!-- return -->





<h1 data-toc-skip>Consent Mode v2 - A Comprehensive Technical Guide</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      Posted
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class=""
  data-ts="1706652001"
  data-df="ll"
  
    data-toggle="tooltip" data-placement="bottom"
  
>
  Jan 30, 2024
</em>

    </span>

    <!-- lastmod date -->
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      By

      <em>
      
        
          <a href="https://gunnargriese.com">Gunnar Griese</a>
          
        
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-toggle="tooltip"
  data-placement="bottom"
  title="5868 words"
>
  <em>32 min</em> read</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <p>In fall 2023, the EU has deemed <a href="https://blog.google/outreach-initiatives/public-policy/building-for-compliance-with-the-digital-markets-act/">Google as a gatekeeper</a> in the digital space under the Digital Markets Act (DMA), placing it under heightened legal scrutiny. In response to this assessment and to meet the DMA enforcement deadline in March 2024, Google is adjusting its advertising solutions. One aspect of this change is the latest update to Google Consent Mode. Starting in March 2024, Consent Mode will become mandatory for all advertisers operating in the EEA and wanting to use all of Google’s GMP advertising features. This shift, which includes <a href="https://support.google.com/analytics/answer/11583528?hl=en#:~:text=before%20this%20date.-,For%20Google%20Analytics%20360%20customers,-Universal%20Analytics%20360">phasing out certain features in the remaining UA360 properties</a> while at the same time providing insufficient documentation on the new feature’s functionality and behavior, left the community with a lot of open questions.</p>

<p>This blog post is the product of me penning down my observations and combining them with the ones from my peers in the industry to contribute to a better understanding of Google’s Consent Mode v2 and its impact on data collection. Overall, the aim is to provide readers (and me as the author) with a comprehensive overview of Consent Mode v2 and help them make informed decisions about their website’s privacy and data practices by unveiling the technical intricacies.</p>

<p>This blog post can be seen as the technical counterpart of <a href="https://iihnordic.com/news/update-of-consent-state-and-its-impact-on-advertisers/?ref=gunnargriese.com">my previous thoughts on Consent Mode v2</a> published on the IIH Nordic blog. If you are new to the topic, I recommend reading the previous blog post first to get a better understanding of the topic’s context and the implications of Consent Mode v2.</p>

<h2 id="introduction-to-consent-mode-v2"><span class="mr-2">Introduction to Consent Mode v2</span><a href="#introduction-to-consent-mode-v2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p><strong>Google’s Consent Mode v2 becomes mandatory on March 6, 2024</strong>, for all advertisers targeting the European Economic Area (EEA), including the UK. Implementing this update is <strong>essential for maintaining access to the Google Marketing Platform’s (GMP) remarketing and targeting functionalities</strong>, regardless of the company’s location, as long as it engages EEA users. The general idea of Consent Mode is to signal user consent states (granted vs. denied) for various consent types to Google tools and generate data through additional signals (so-called pings) even in the absence of user consent.</p>

<p>The following consent types are supported by Consent Mode v2:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Consent Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ad_storage</code></td>
      <td>Enables storage, such as cookies (web) or device identifiers (apps), related to advertising</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ad_user_data</code></td>
      <td><strong>New in v2:</strong> Sets consent for sending user data to Google for online advertising purposes.<br />(Will be inferred from <code class="language-plaintext highlighter-rouge">ad_storage</code> )</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ad_personalization</code></td>
      <td><strong>New in v2:</strong> Sets consent for personalized advertising</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">analytics_storage</code></td>
      <td>Enables storage, such as cookies (web) or device identifiers (apps), related to analytics, for example, visit duration</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">functionality_storage</code></td>
      <td>Enables storage that supports the functionality of the website or app, for example, language settings</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">personalization_storage</code></td>
      <td>Enables storage related to personalization, for example, video recommendations</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">security_storage</code></td>
      <td>Enables storage related to security such as authentication functionality, fraud prevention, and other user protection</td>
    </tr>
  </tbody>
</table></div>

<p>The collected signals and additional data points aid in modeling conversions (e.g., for Google Ads and Floodlight) and tracking and modeling user behavior and conversions (for GA4). Consent Mode allows for (limited) data capture in line with user consent preferences through two variants: ‘Basic’ and ‘Advanced.’ The ‘Basic’ variant is the future minimum requirement for advertisers, whereas the ‘Advanced’ mode allows for fuller use of Google’s data modeling capabilities. The ‘Advanced’ variant enables data collection on websites through more or less complete requests, but without cookies, whenever consent is not given or explicitly denied. The aim is to fill data collection gaps and to provide advertisers with a more complete, modeled picture of their users’ behavior. These two options have been available since the initial release of Consent Mode. However, with the latest update, Google increased the focus on their availability.</p>

<p><a href="/gunnargriese.github.io/assets/img/consent-mode/consent-mode-architecture.png" class="popup img-link "><img data-src="/gunnargriese.github.io/assets/img/consent-mode/consent-mode-architecture.png" alt="consent-mode-architecture" class="lazyload" data-proofer-ignore></a>
<em>Source: Own Visualization</em></p>

<p>Moreover, with Consent Mode v2, two new consent states have been introduced: <code class="language-plaintext highlighter-rouge">ad_user_data</code> and <code class="language-plaintext highlighter-rouge">ad_personalization</code>. These two new consent states allow for more granular control over what data is collected and how the data is processed and shared between interconnected GMP tools, like GA, Google Ads, etc. The new consent states highly aim to control the data activation processes. In that sense, Consent Mode v2 increasingly becomes a control layer for advertisers for all data collection (<code class="language-plaintext highlighter-rouge">ad_storage</code> &amp; <code class="language-plaintext highlighter-rouge">analytics_storage</code>) and activation mechanisms (<code class="language-plaintext highlighter-rouge">ad_user_data</code> &amp; <code class="language-plaintext highlighter-rouge">ad_personalization</code>) in the GMP. This is an aspect that is often overlooked when discussing Consent Mode v2. Traditionally, the focus is very much on the data collection aspect for websites, but Consent Mode v2 is much more than that.</p>

<h3 id="basic-implementation"><span class="mr-2">Basic Implementation</span><a href="#basic-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>When a user lands on a website or uses an app for the first time, the advertiser blocks Google tags and SDKs by default. At this point, the advertiser shares no user data with Google. As we know, the page then presents the user with a consent banner. The user can grant or deny tracking consent (if the setup is correctly implemented…).</p>

<p><a href="/gunnargriese.github.io/assets/img/consent-mode/basic-implementation.png" class="popup img-link "><img data-src="/gunnargriese.github.io/assets/img/consent-mode/basic-implementation.png" alt="consent-mode-basic-implementation" class="lazyload" data-proofer-ignore></a>
<em>Source: Own Visualization of Google source</em></p>

<p>Should the user withhold consent, no tracking occurs, no tags are fired, and Google does not receive any data from the user.
Conversely, if the user agrees and provides consent, the advertiser updates the consent states for Consent Mode and conveys it to the Google tags/SDK. This action effectively lifts the blockade, allowing the tags and SDKs to function as intended (=using cookies).</p>

<p>This is most likely the implementation that most advertisers have implemented, as it is the easiest and least “risky” from a legal perspective. However, it also comes with the most significant drawback, as it only allows for data collection in the presence of consent. Advertisers that do not collect data for unconsented users will naturally experience a less complete picture of their user’s behavior.</p>

<h3 id="advanced-implementation"><span class="mr-2">Advanced Implementation</span><a href="#advanced-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Advanced Consent Mode operates under a paradigm where advertisers do not entirely block Google tags and SDKs without user consent. Unlike the Basic Implementation, where consent is a prerequisite for data processing, the Advanced Mode proceeds with data collection regardless of consent. Still, it does not use any cookies in that case.
When users deny consent, the Advanced Mode employs “cookieless pings”. These are regular events/hits sent to Google’s servers but do not incorporate regular cookie values. Cookieless pings then allow Google to use these for modeling granular and aggregated data for analytics (Behavioral Modeling) and advertisement performance purposes (Conversion Modeling).</p>

<p><a href="/gunnargriese.github.io/assets/img/consent-mode/advanced-implementation.png" class="popup img-link "><img data-src="/gunnargriese.github.io/assets/img/consent-mode/advanced-implementation.png" alt="advanced-implementation" class="lazyload" data-proofer-ignore></a>
<em>Source: Own Visualization of Google source</em></p>

<p>The advertiser communicates their users’ consent states to Google, which determines how Google processes, exposes and uses the data. From the table above, the reader can infer the exact implication of each consent state on the tags’ data collection behavior.</p>

<p>The general idea of the Advanced Consent Mode is that even when cookies are not permissible, advertisers can obtain valuable insights in a privacy-conscious manner.</p>

<h3 id="basic-vs-advanced-implementation"><span class="mr-2">Basic vs. Advanced Implementation</span><a href="#basic-vs-advanced-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>To summarize, the Basic Implementation ensures that no data is collected without consent and utilizes cookies once consent is granted. The Advanced Implementation, on the other hand, additionally allows for data collection without consent, but without cookies in that case. Advanced Implementation is the only way to collect data that feeds Google’s embedded models without consent.</p>

<p>Here are the tradeoffs between advanced and basic implementation for consent mode:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th> </th>
      <th>Advanced Implementation</th>
      <th>Basic Implementation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Tag Behavior</td>
      <td>Google tags are loaded before the consent dialog appears. <br /> Tags send cookieless pings when cookie consent is declined.</td>
      <td>Google tags are blocked until consent is granted.</td>
    </tr>
    <tr>
      <td>Behavioral Modeling in GA4</td>
      <td>yes</td>
      <td>no</td>
    </tr>
    <tr>
      <td>Conversion Modeling in GA4</td>
      <td>yes</td>
      <td>yes*</td>
    </tr>
    <tr>
      <td>Conversion Modeling in Google Ads</td>
      <td>yes</td>
      <td>yes*</td>
    </tr>
  </tbody>
</table></div>

<p>* When tags are blocked due to consent choices, no data is collected, and conversion modeling in Ads is based on a general model. The modes use features such as browser type, conversion action type, time of day, and other high-level, non-identofying variables. This model is less accurate than the model used when tags are unblocked, but it is more accurate than not using a model at all.</p>

<p><em>Source: <a href="https://support.google.com/analytics/answer/9976101?hl=en">Advanced vs. basic implementation</a></em></p>

<blockquote>
  <p>DISCLAIMER: While advertisers should adopt the Consent Mode update to ensure remarketing efforts stay efficient, they should not take the choice of whether or not to implement the “Advanced” variant lightly. The “Advanced” mode allows for more data collection, which may benefit campaign performance. However, it might also come with a higher risk of non-compliance with legislation like ePrivacy, which could result in fines and other penalties. Hence, I strongly advocate involving your legal department in deciding on the abovementioned trade-off.</p>
</blockquote>

<h2 id="implications-of-adopting-consent-mode-v2"><span class="mr-2">Implications of Adopting Consent Mode v2</span><a href="#implications-of-adopting-consent-mode-v2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>With the two additional consent states — <code class="language-plaintext highlighter-rouge">ad_user_data</code> and <code class="language-plaintext highlighter-rouge">ad_personalization</code> — Consent Mode v2 allows for enhanced user consent granularity and gives advertisers tools to directly affect how Google services can <a href="https://developers.google.com/tag-platform/security/concepts/consent-mode">utilize collected data</a>.</p>

<p>The <code class="language-plaintext highlighter-rouge">ad_user_data</code> consent state governs whether advertisers can send user data to Google for advertising purposes. Denial of this consent has the following implications:</p>

<ul>
  <li><strong>User ID Collection</strong>: If <code class="language-plaintext highlighter-rouge">ad_user_data</code> consent is denied, no user-specific identifiers are collected or processed. This restriction negatively impacts the ability of advertisers to measure cross-device user interactions.</li>
  <li><strong>Enhanced Conversions</strong>: Denying consent for <code class="language-plaintext highlighter-rouge">ad_user_data</code> means that Enhanced Conversions, which rely on (hashed) first-party data (1PD), will not be processed in Google Ads and GA4. This limitation hinders the ability to track users’ post-ad interactions, potentially leading to less efficient ad performance measurement and ad spending.</li>
  <li><strong>GA4 Conversion Export</strong>: Additionally, the export of GA4 conversions to the GMP will cease to function without <code class="language-plaintext highlighter-rouge">ad_user_data</code> consent, disrupting the flow of conversion data used for broader marketing analysis and campaign adjustments.</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">ad_personalization</code> consent state, on the other hand, controls the allowance for personalized advertising:</p>

<ul>
  <li><strong>Remarketing Capabilities</strong>: With <code class="language-plaintext highlighter-rouge">ad_personalization</code> set to denied, the user will not enter any potential remarketing lists.</li>
  <li><strong>GMP Personalized Advertising</strong>: Using GMP tools for personalized advertising also becomes impossible without consent for <code class="language-plaintext highlighter-rouge">ad_personalization</code>. This restriction can significantly reduce the effectiveness of ad campaigns targeted based on user preferences and behaviors.</li>
</ul>

<p>The above functionality also explains why Google explicitly added these two new consent states to the remaining data collection mechanisms - APIs and Measurement Protocol. Advertisers can use these methods to enable remarketing use cases (e.g., Customer Match via API upload) or send offline conversions with 1PD (e.g., Enhanced Conversions for Leads). Hence, advertisers must also send users’ consent signals for these data points to ensure a comprehensively designed system from Google’s perspective.</p>

<h2 id="implementation-of-consent-mode-v2"><span class="mr-2">Implementation of Consent Mode v2</span><a href="#implementation-of-consent-mode-v2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>For those who have previously integrated the previous version of Consent Mode and consciously decided whether to use Basic or Advanced, transitioning to v2 is a straightforward process that involves updating the existing configurations to recognize and handle the two new consent states.</p>

<p>At the core of Consent Mode are two key commands that govern user consent states:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Default Command</code>: This sets the initial consent state, which comes into play before a user has made their consent choices known. Establishing this state immediately upon every page load is the important thing here.</li>
  <li><code class="language-plaintext highlighter-rouge">Update Command</code>: This command is used to revise the consent state once the user has made their choices clear. It ensures the user’s consent preferences are captured and applied consistently to all applicable tags throughout browsing.</li>
</ul>

<p>To accurately implement these commands, it’s best to adhere to the protocols provided by your Consent Management Platform (CMP). Many CMPs offer step-by-step guides for integrating Consent Mode v2, which typically involve gtag.js and Google Tag Manager (GTM) Sandbox APIs, preferably via template configurations. Advertisers should consult their CMP’s documentation to ensure a smooth integration process.</p>

<h3 id="using-gtagjs-web"><span class="mr-2">Using gtag.js (web)</span><a href="#using-gtagjs-web" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The Google tag (gtag.js) is a JavaScript tagging framework and API that allows you to send event data to Google Analytics, Google Ads, and other GMP tools. The gtag.js tagging library uses the global <code class="language-plaintext highlighter-rouge">gtag()</code> function to send data to Google’s servers. The gtag.js library supports Consent Mode v2 natively and allows for implementing the two key commands mentioned above.</p>

<h4 id="set-default-consent-state"><span class="mr-2">Set default consent state</span><a href="#set-default-consent-state" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>Ideally, the default consent state is called on every page on your site and set before any other consent mode commands (or other Google tag execution). This ensures that the default consent state is applied to all subsequent gtag.js commands. Furthermore, the default consent state is applied to all subsequent gtag.js commands until the consent state is updated. The consent state values in this article are only examples and should match your organization’s policy for your specific implementation.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nb">window</span><span class="p">.</span><span class="nf">gtag</span><span class="p">(</span><span class="dl">"</span><span class="s2">consent</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">default</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">analytics_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ad_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ad_user_data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ad_personalization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">wait_for_update</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="c1">// Optional. A millisecond value to control how long to wait before data is sent by any Google tags</span>
  <span class="na">region</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">ES</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">DE</span><span class="dl">"</span><span class="p">],</span> <span class="c1">// Optional. A region value to fine-tune defaults based on your users' geographic locations. See Geographical IDs for more information on identifying regions.</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>By specifying regions in the consent command, you can limit the default behavior of your tags to the specified locations, ensuring compliance with regional data protection regulations. For more nuanced control based on user location, delve into the Geographical IDs documentation to enhance your site’s <a href="https://developers.google.com/analytics/devguides/collection/protocol/v1/geoid">regional specificity</a> in consent management. For those employing an asynchronous CMP, the <code class="language-plaintext highlighter-rouge">wait_for_update</code> parameter is a valuable tool that dictates the latency before Google tags send out data, allowing the consent state to be updated. This parameter is unnecessary for synchronous platforms, where consent determination occurs instantaneously.</p>

<h4 id="update-consent-state"><span class="mr-2">Update consent state</span><a href="#update-consent-state" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>As users navigate a website, they may alter their consent preferences. The Consent Mode implementation should respond to these interactions by utilizing the <code class="language-plaintext highlighter-rouge">update</code> command to modify the consent status as soon as possible. Maintaining the user’s choice throughout their session is equally vital upon obtaining consent. Ensure the <code class="language-plaintext highlighter-rouge">update</code> command is invoked on subsequent pages to reflect their current consent status accurately.</p>

<p>And remember, it is only necessary to issue updates when there is an actual change in the user’s consent status. Most CMPs will automatically issue an update command on every page once the user has made a consent decision.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nb">window</span><span class="p">.</span><span class="nf">gtag</span><span class="p">(</span><span class="dl">"</span><span class="s2">consent</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">update</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">analytics_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ad_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ad_user_data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ad_personalization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="set-url-passthrough"><span class="mr-2">Set url passthrough</span><a href="#set-url-passthrough" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The <code class="language-plaintext highlighter-rouge">url_passthrough</code> setting in the Consent Mode framework aims to improve the accuracy of conversion tracking by enabling the passing of ad-related information through URL query parameters.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">gtag</span><span class="p">(</span><span class="dl">"</span><span class="s2">set</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">url_passthrough</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<blockquote>
  <p>Note: This command is usually added to the default snippet before any <code class="language-plaintext highlighter-rouge">gtag('config',...)</code> commands.</p>
</blockquote>

<p>This feature becomes relevant when a user’s consent settings prevent the storage of ad-related data (<code class="language-plaintext highlighter-rouge">ad_storage</code>: denied). Instead of relying on first-party cookies, which usually capture details from ad clicks, URL passthrough ensures this information is carried across pages until a conversion occurs within the URL. Hence, this method unlocks the measurement of ad click efficacy.</p>

<p>For URL passthrough to function, several prerequisites must be satisfied:</p>

<ul>
  <li>The navigational link must lead to the same domain.</li>
  <li>A Google Click Identifier (GCLID) or DoubleClick Click Identifier (DCLID) must be present in the URL.</li>
</ul>

<p>When the advertiser’s implementation meets these conditions, URL passthrough is a (not so robust) alternative to traditional cookies.</p>

<h4 id="obtain-current-consent-state"><span class="mr-2">Obtain current consent state</span><a href="#obtain-current-consent-state" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>To quickly ascertain the current consent state for any consent type, you can utilize the <code class="language-plaintext highlighter-rouge">getConsentState</code> method from the Google tag’s global object. Executing the following will return a binary value: 0 indicates no consent (denied), and 1 signifies consent has been granted:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">google_tag_data</span><span class="p">.</span><span class="nx">ics</span><span class="p">.</span><span class="nf">getConsentState</span><span class="p">(</span><span class="dl">"</span><span class="s2">ad_storage</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// Example for ad_storage</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This provides a quick and efficient means of checking user consent in real-time using the pre-defined APIs.</p>

<h4 id="listen-for-consent-state-changes"><span class="mr-2">Listen for consent state changes</span><a href="#listen-for-consent-state-changes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>To monitor and respond to changes in user consent for ads and analytics, you can set up a listener using the <code class="language-plaintext highlighter-rouge">addListener</code> method of the Google tag’s object:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">google_tag_data</span><span class="p">.</span><span class="nx">ics</span><span class="p">.</span><span class="nf">addListener</span><span class="p">(</span>
  <span class="p">[</span><span class="dl">"</span><span class="s2">ad_storage</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">analytics_storage</span><span class="dl">"</span><span class="p">],</span>
  <span class="nf">function </span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Consent state for either ads or analytics changed:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The above code snippet adds a listener for consent states for <code class="language-plaintext highlighter-rouge">ad_storage</code> and <code class="language-plaintext highlighter-rouge">analytics_storage</code>. When a change occurs in either consent state, the callback function is executed, logging a message and the event details to the console. This enables real-time tracking and reaction capabilities of user consent preferences within your website or application.</p>

<h3 id="using-google-tag-manager-sandbox-apis-web"><span class="mr-2">Using Google Tag Manager Sandbox APIs (web)</span><a href="#using-google-tag-manager-sandbox-apis-web" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Google also included the gtag API functionalities for Consent Mode into GTM’s Sandbox APIs, making it possible to build and use native community tags and variable templates in our GTM containers.</p>

<p>Consider using Simo Ahava’s template for a streamlined implementation of Consent Mode v2. Available <a href="https://tagmanager.google.com/gallery/#/owners/gtm-templates-simo-ahava/templates/consent-mode">here</a>, this template is ideally suited to orchestrate the Consent Mode implementation.</p>

<p><a href="/gunnargriese.github.io/assets/img/consent-mode/simo-gtm-template.png" class="popup img-link "><img data-src="/gunnargriese.github.io/assets/img/consent-mode/simo-gtm-template.png" alt="simo-gtm-template" class="lazyload" data-proofer-ignore></a>
<em>Source: Own GTM Setup</em></p>

<p>Below, we have a closer look into the specific methods employed by this template or similar ones, which are examples of their utilization. For more technical details on the APIs, see <a href="https://developers.google.com/tag-platform/tag-manager/templates/consent-apis">here</a>.</p>

<h4 id="set-default-consent-state-1"><span class="mr-2">Set default consent state</span><a href="#set-default-consent-state-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>By invoking the <code class="language-plaintext highlighter-rouge">setDefaultConsentState</code> method from a tag template, the default consent state is pushed to the data layer. GTM processes this update <strong>immediately</strong> after the current event, and any tags triggered by it have finished processing or when the tag processing timeout is reached, whichever comes first. The implementation ensures that the consent update is prioritized and processed in the GTM container before other items are queued in the data layer. This approach guarantees that user consent preferences are accurately reflected and adhered to across all subsequent tag executions.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">setDefaultConsentState</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">setDefaultConsentState</span><span class="dl">"</span><span class="p">);</span>

<span class="nf">setDefaultConsentState</span><span class="p">({</span>
  <span class="na">ad_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ad_user_data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ad_personalization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">analytics_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">functionality_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">personalization_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">security_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">wait_for_update</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="c1">// optional</span>
  <span class="na">region</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">DE</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">US</span><span class="dl">"</span><span class="p">],</span> <span class="c1">// optional</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>This prioritization is critical to remember, as this command allows you to bypass the command queue, which, i.e., the gtag API is subject to. So, if you want to use Consent Mode with GTM, I recommend using a GTM template utilizing the respective Sandbox APIs.</p>

<p>Including optional parameters like <code class="language-plaintext highlighter-rouge">wait_for_update</code> and region offers additional flexibility, allowing for fine-tuned control based on specific timing needs and geographic considerations. These parameters are optional and work as described for the gtag API.</p>

<h4 id="update-consent-state-1"><span class="mr-2">Update consent state</span><a href="#update-consent-state-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The <code class="language-plaintext highlighter-rouge">updateConsentState</code> function allows for dynamic updating of consent states across various categories. The values for these categories can be dynamically populated, for instance, using variables that reflect the user’s choices as recorded by the CMP.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">updateConsentState</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">updateConsentState</span><span class="dl">"</span><span class="p">);</span>

<span class="nf">updateConsentState</span><span class="p">({</span>
  <span class="na">ad_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// Can be dynamically populated. E.g., using a variable</span>
  <span class="na">ad_user_data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">ad_personalization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">analytics_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">functionality_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">personalization_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">security_storage</span><span class="p">:</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span><span class="p">,</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Similar to the <code class="language-plaintext highlighter-rouge">setDefaultConsentState</code>, this function pushes a gtag set command to the data layer and guarantees that the updated consent state is recognized and acted upon in the GTM container before processing any other items in the data layer queue.</p>

<h4 id="set-url-passthrough-and-ads_data_redaction"><span class="mr-2">Set url passthrough and ads_data_redaction</span><a href="#set-url-passthrough-and-ads_data_redaction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The previously mentioned <code class="language-plaintext highlighter-rouge">gtag('set',...)</code>commands, like <code class="language-plaintext highlighter-rouge">ads_data_redaction</code> or <code class="language-plaintext highlighter-rouge">url_passthrough</code> are available as well, allowing for the same functionality as the gtag API. Developers can use the <code class="language-plaintext highlighter-rouge">gtagSet</code> function in custom GTM templates to implement these commands.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">gtagSet</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">gtagSet</span><span class="dl">"</span><span class="p">);</span>
<span class="nf">gtagSet</span><span class="p">(</span><span class="dl">"</span><span class="s2">ads_data_redaction</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nf">gtagSet</span><span class="p">(</span><span class="dl">"</span><span class="s2">url_passthrough</span><span class="dl">"</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="listen-for-consent-state-changes-1"><span class="mr-2">Listen for consent state changes</span><a href="#listen-for-consent-state-changes-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The <code class="language-plaintext highlighter-rouge">addConsentListener</code> function registers a listener that triggers whenever there’s a change in the consent status of a specified type (e.g., <code class="language-plaintext highlighter-rouge">analytics_storage</code>), such as shifting from “denied” to “granted” or vice versa. However, it’s important to note that this function does not activate if a previously unset consent type is updated to “granted”, as an unset state is already considered as “granted”.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">isConsentGranted</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">isConsentGranted</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">addConsentListener</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">addConsentListener</span><span class="dl">"</span><span class="p">);</span>

<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nf">isConsentGranted</span><span class="p">(</span><span class="dl">"</span><span class="s2">ad_storage</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">wasCalled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nf">addConsentListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">ad_storage</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">consentType</span><span class="p">,</span> <span class="nx">granted</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">wasCalled</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="nx">wasCalled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">cookies</span> <span class="o">=</span> <span class="nf">getMyCookies</span><span class="p">();</span>
    <span class="nf">sendFullPixel</span><span class="p">(</span><span class="nx">cookies</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Additionally, the <code class="language-plaintext highlighter-rouge">isConsentGranted</code> function returns “true” if a particular consent type is deemed granted. This status is achieved either when the consent type is explicitly set to ‘granted’ or when it remains unset. Any other setting for the consent type is interpreted as not granted.</p>

<p>Combining these two functions allows for the creation of a listener that triggers when a particular consent type is granted. This is useful for implementing a fallback mechanism for when a user grants consent for a specific type of consent.</p>

<h3 id="using-firebase-sdk-app"><span class="mr-2">Using Firebase SDK (app)</span><a href="#using-firebase-sdk-app" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The Firebase Analytics SDK library enables you to collect behavioral data from your app for GA4. The <a href="https://developers.google.com/tag-platform/security/guides/app-consent?platform=ios">Firebase SDK natively supports Consent Mode v2</a> and allows for implementing the two critical commands mentioned before. Regardless, adopting Consent Mode v2 in your app is probably the biggest challenge in the migration process, as very few companies have implemented it so far. But as of March 6th, 2024, it will be mandatory for all advertisers targeting EEA users and wanting to use all GMP functionalities - also for app tracking.</p>

<h4 id="set-default-consent-state-2"><span class="mr-2">Set default consent state</span><a href="#set-default-consent-state-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>As for the web, when integrating the Firebase SDK for app development, configuring the default consent state is crucial for managing user privacy preferences. Out of the box, the app does not establish any consent mode values within an application. Access your app’s <code class="language-plaintext highlighter-rouge">info.plist</code> file to set these defaults. Within this file, the app developer introduces consent mode key-value pairs, where each key represents a specific type of consent, and the value indicates the consent state—true for granted consent and false for denied.
To exemplify, if you aim to deny consent by default for all parameters, your <code class="language-plaintext highlighter-rouge">info.plist</code> should include entries like the following:</p>

<div class="language-text highlighter-rouge"><div class="code-header">
        <span data-label-text="Text"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>&lt;keyGOOGLE_ANALYTICS_DEFAULT_ALLOW_ANALYTICS_STORAGE&lt;/key &lt;denied/
&lt;keyGOOGLE_ANALYTICS_DEFAULT_ALLOW_AD_STORAGE&lt;/key &lt;denied/
&lt;keyGOOGLE_ANALYTICS_DEFAULT_ALLOW_AD_USER_DATA&lt;/key &lt;denied/
&lt;keyGOOGLE_ANALYTICS_DEFAULT_ALLOW_AD_PERSONALIZATION_SIGNALS&lt;/key &lt;denied/
</pre></td></tr></tbody></table></code></div></div>

<h4 id="update-consent"><span class="mr-2">Update consent</span><a href="#update-consent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>As we know, the users’ consent states must be updated after their consent decisions. This is achieved through the <code class="language-plaintext highlighter-rouge">setConsent</code> method within the Firebase SDK. When invoked, this method overwrites the default consent settings and ensures that the updated preferences are preserved across future app launches. These updated consent states remain active until <code class="language-plaintext highlighter-rouge">setConsent</code> is executed again, ensuring that changes in user preferences are respected, even if the app is closed and later reopened. <code class="language-plaintext highlighter-rouge">setConsent</code> allows for selective updates, affecting only the specified consent parameters - just like its gtag.js counterpart.</p>

<p>For instance, to update all consent values to “granted” status, developers can utilize the following Swift code snippet:</p>

<div class="language-swift highlighter-rouge"><div class="code-header">
        <span data-label-text="Swift"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kt">Analytics</span><span class="o">.</span><span class="nf">setConsent</span><span class="p">([</span>
  <span class="o">.</span><span class="nv">analyticsStorage</span><span class="p">:</span> <span class="o">.</span><span class="n">granted</span><span class="p">,</span>
  <span class="o">.</span><span class="nv">adStorage</span><span class="p">:</span> <span class="o">.</span><span class="n">granted</span><span class="p">,</span>
  <span class="o">.</span><span class="nv">adUserData</span><span class="p">:</span> <span class="o">.</span><span class="n">granted</span><span class="p">,</span>
  <span class="o">.</span><span class="nv">adPersonalization</span><span class="p">:</span> <span class="o">.</span><span class="n">granted</span><span class="p">,</span>
<span class="p">])</span>
</pre></td></tr></tbody></table></code></div></div>

<p>For more details on how to debug apps using Firebase Analytics, see <a href="/posts/firebase-analytics-debugging/">here</a>.</p>

<h3 id="measurement-protocol"><span class="mr-2">Measurement Protocol</span><a href="#measurement-protocol" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The Measurement Protocol (MP) is a tool for sending event data directly to Google Analytics servers via HTTP requests, enabling enriching web and app interactions with server-side data.</p>

<p>With Consent Mode v2, the MP incorporates a consent attribute explicitly configuring consent types and states within each request. If specific consent parameters are not included in a request, GA4 will default to the consent settings established through online interactions associated with the same client ID or app instance. Hence, setting the attribute via the MP might not be as crucial as it is for websites and apps because it can be inferred from other events.</p>

<p>For example, when sending event data, such as a purchase event, you can specify consent states for data collection and processing through the MP. The following CURL command demonstrates how to include consent attributes for <code class="language-plaintext highlighter-rouge">ad_user_data</code> and <code class="language-plaintext highlighter-rouge">ad_personalization</code> within an event payload:</p>

<div class="language-text highlighter-rouge"><div class="code-header">
        <span data-label-text="Text"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre>curl -X POST 'https://www.google-analytics.com/debug/mp/collect?api_secret=&lt;your-key&gt;&amp;measurement_id=G-XXXXXX' \
 -H 'Content-Type: application/json' \
 -d '{
   "client_id": "709808103.1671720316",
   "events": [
     {
       "name": "purchase",
       "params": {
         "items": [
           {
             "item_id": "SKUTest1234",
             ...
           },

         ],
         "currency": "DKK",
         ...
         "ad_user_data": "granted",
         "ad_personalization": "denied"
       }
     }
   ]
}'
</pre></td></tr></tbody></table></code></div></div>

<h3 id="google-apis"><span class="mr-2">Google APIs</span><a href="#google-apis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Lastly, let’s briefly look at Google’s APIs and how they are affected by Consent Mode v2. APIs are yet another way for advertisers to ingest data into Google’s system, helping them to enable remarketing use cases (e.g., Customer Match via API upload) or send offline conversions with 1PD (e.g., Enhanced Conversions for Leads). Hence, advertisers must also send users’ consent signals for these data points to ensure a comprehensively designed system from Google’s perspective.</p>

<p>For example, the Google Ads API introduced an update by incorporating the <code class="language-plaintext highlighter-rouge">Consent</code> object. This object is now a prerequisite for data uploads associated with call conversions, click conversions, Customer Match, and Store Sales, in line with how consent is managed within the remaining ecosystem. Advertisers must now explicitly set consent for each data interaction, as detailed below:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Feature</th>
      <th>Code change</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Call Conversions</td>
      <td>Set <code class="language-plaintext highlighter-rouge">Consent</code> for each call conversion event at <code class="language-plaintext highlighter-rouge">CallConversion.consent</code>.</td>
    </tr>
    <tr>
      <td>Click Conversions</td>
      <td>Set <code class="language-plaintext highlighter-rouge">Consent</code> for each click conversion event at <code class="language-plaintext highlighter-rouge">ClickConversion.consent</code>.</td>
    </tr>
    <tr>
      <td>Customer Match</td>
      <td>Set <code class="language-plaintext highlighter-rouge">Consent</code> for each Customer Match job at <code class="language-plaintext highlighter-rouge">CustomerMatchUserListMetadata.consent</code>.</td>
    </tr>
    <tr>
      <td>Store Sales</td>
      <td>Set <code class="language-plaintext highlighter-rouge">Consent</code> for each Store Sales event at <code class="language-plaintext highlighter-rouge">UserData.consent</code>.</td>
    </tr>
  </tbody>
</table></div>

<p><em>Source: <a href="https://ads-developers.googleblog.com/2023/10/updates-to-customer-match-conversion.html">Google Ads Developer Blog</a></em></p>

<p>This structured approach to consent within the Google Ads and other GMP APIs ensures that all data interactions (ideally) comply with user preferences. By integrating the <code class="language-plaintext highlighter-rouge">Consent</code> object across these features, Google provides advertisers with the tools to manage consent more effectively and forces them to think about whether or not the correct has been obtained to share this data.</p>

<h2 id="validating-the-consent-mode-v2-implementation"><span class="mr-2">Validating the Consent Mode v2 Implementation</span><a href="#validating-the-consent-mode-v2-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Now that we have covered the implementation of Consent Mode v2, it is time to validate the setup. The following section provides a comprehensive overview of how to validate the Consent Mode v2 implementation using various methods and tools.</p>

<h3 id="using-gtm-preview-mode"><span class="mr-2">Using GTM Preview Mode</span><a href="#using-gtm-preview-mode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The GTM Preview Mode is a powerful tool for validating the Consent Mode v2 implementation. It allows you to inspect the consent state and the data layer, and to verify that the consent state is being updated correctly.</p>

<h4 id="gtm-web-preview"><span class="mr-2">GTM Web Preview</span><a href="#gtm-web-preview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>When using the GTM Web Preview, you can inspect the consent state in the GTM interface. The consent state is displayed in the “Consent” tab of the GTM interface, and you can see the current consent state for each consent type. Overall, the interface gives you insight into the following for every recorded dataLayer event:</p>

<ul>
  <li><strong>On-page Default</strong> (inferred from default command)</li>
  <li><strong>On-page Update</strong> (inferred from update command)</li>
  <li><strong>Current State</strong> (consent state applicable to the current event and associated tags)</li>
</ul>

<p><a href="/gunnargriese.github.io/assets/img/consent-mode/gtm-web-consent-state.png" class="popup img-link "><img data-src="/gunnargriese.github.io/assets/img/consent-mode/gtm-web-consent-state.png" alt="gtm-web-consent-state-preview" class="lazyload" data-proofer-ignore></a>
<em>Source: Own GTM Setup</em></p>

<h4 id="gtm-server-side-preview"><span class="mr-2">GTM Server-Side Preview</span><a href="#gtm-server-side-preview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>For the GTM Server-Side Preview, we are missing a user-friendly interface like the one for the web preview. However, we can inspect the consent state once the GA4 client parses the incoming event data. The event data exposes the consent states as part of the <code class="language-plaintext highlighter-rouge">x-sst-system-properties</code> object. From here, you can use the consent state to block or allow certain tags from firing based on the user’s consent preferences. Or pass the consent state to your tags for further analysis downstream.</p>

<p><a href="/gunnargriese.github.io/assets/img/consent-mode/gtm-ss-system-properties.png" class="popup img-link "><img data-src="/gunnargriese.github.io/assets/img/consent-mode/gtm-ss-system-properties.png" alt="gtm-ss-system-properties" class="lazyload" data-proofer-ignore></a>
<em>Source: Own GTM Setup</em></p>

<h3 id="using-the-datalayer-object"><span class="mr-2">Using the dataLayer object</span><a href="#using-the-datalayer-object" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Since the gtag API eventually pushes all of its events and data to the data layer, you can also inspect the consent state directly in the data layer. This is especially useful when you want to validate the consent state without using GTM (e.g., plain JS) or when you want to verify that the consent state is being updated correctly using the browser’s console.</p>

<p>In the dataLayer, you can see the <code class="language-plaintext highlighter-rouge">default</code> and <code class="language-plaintext highlighter-rouge">update</code> commands and the respective consent states set for each type. This is a great way to verify that the consent state is being updated correctly and that the correct consent state is being applied to your tags.</p>

<p><a href="/gunnargriese.github.io/assets/img/consent-mode/dataLayer-consent-state.png" class="popup img-link "><img data-src="/gunnargriese.github.io/assets/img/consent-mode/dataLayer-consent-state.png" alt="dataLayer-consent-state" class="lazyload" data-proofer-ignore></a>
<em>Source: Own GTM Setup</em></p>

<blockquote>
  <p>This will only work if you have implemented the consent state using gtag.js. If you have used the GTM Sandbox APIs, you cannot inspect the consent state as described above.</p>
</blockquote>

<h3 id="using-the-google_tag_data-object"><span class="mr-2">Using the google_tag_data object</span><a href="#using-the-google_tag_data-object" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>The first time that I saw the <code class="language-plaintext highlighter-rouge">google_tag_data</code> object was when I was reading <a href="https://support.cookiebot.com/hc/en-us/articles/360018413380-Checking-if-Consent-Mode-is-properly-implemented">Cookiebot blog post</a> on Consent Mode v2. This global object is available on the page and contains information about the current consent state. You can use this object to listen for changes in the consent state and obtain the current consent state for each type.</p>

<p>Again, this is helpful if you want to use plain JS to validate the consent state and trigger or orchestrate other logic based on the user’s consent preferences.</p>

<h4 id="google_tag_dataicsentries"><span class="mr-2">google_tag_data.ics.entries</span><a href="#google_tag_dataicsentries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>Using the <code class="language-plaintext highlighter-rouge">google_tag_data.ics.entries</code> object, you can inspect the current consent state for each consent type. This is a great way to verify that the consent state is being updated correctly and that the correct consent state is being applied to your tags. Using the following snippet, you can log the current consent state for each consent type nicely formatted to the console:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">s</span> <span class="o">==</span> <span class="kc">undefined</span> <span class="p">?</span> <span class="dl">""</span> <span class="p">:</span> <span class="nx">s</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">denied</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">s</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">granted</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">color: #0C0</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">color: #C00</span><span class="dl">"</span><span class="p">);</span>
  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="dl">"</span><span class="s2">google_tag_data</span><span class="dl">"</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">No Consent Mode data found</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">google_tag_data</span><span class="p">.</span><span class="nx">ics</span><span class="p">.</span><span class="nx">entries</span><span class="p">,</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="dl">""</span><span class="p">,</span>
    <span class="nx">t</span> <span class="o">=</span> <span class="dl">""</span><span class="p">,</span>
    <span class="nx">u</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
  <span class="k">for </span><span class="p">(</span><span class="kd">var</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">g</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="nf">l</span><span class="p">(</span><span class="nx">g</span><span class="p">[</span><span class="nx">a</span><span class="p">][</span><span class="dl">"</span><span class="s2">default</span><span class="dl">"</span><span class="p">]);</span>
    <span class="nx">u</span> <span class="o">=</span> <span class="nf">l</span><span class="p">(</span><span class="nx">g</span><span class="p">[</span><span class="nx">a</span><span class="p">][</span><span class="dl">"</span><span class="s2">update</span><span class="dl">"</span><span class="p">]);</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="dl">""</span> <span class="o">&amp;&amp;</span> <span class="nx">u</span> <span class="o">==</span> <span class="dl">""</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
    <span class="nx">t</span> <span class="o">=</span>
      <span class="dl">"</span><span class="se">\t</span><span class="dl">"</span> <span class="o">+</span>
      <span class="nx">a</span> <span class="o">+</span>
      <span class="dl">"</span><span class="s2">:</span><span class="dl">"</span> <span class="o">+</span>
      <span class="p">(</span><span class="nx">i</span> <span class="o">!=</span> <span class="dl">""</span> <span class="p">?</span> <span class="dl">"</span><span class="se">\n\t\t</span><span class="s2">Default: %c</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">i</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">%c</span><span class="dl">"</span><span class="p">)</span> <span class="o">+</span>
      <span class="dl">"</span><span class="s2">%c</span><span class="dl">"</span> <span class="o">+</span>
      <span class="p">(</span><span class="nx">u</span> <span class="o">!=</span> <span class="dl">""</span> <span class="p">?</span> <span class="dl">"</span><span class="se">\n\t\t</span><span class="s2">Update: %c</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">u</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">%c</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">i</span> <span class="o">!=</span> <span class="dl">""</span> <span class="p">?</span> <span class="nf">c</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">:</span> <span class="dl">""</span><span class="p">,</span> <span class="dl">""</span><span class="p">,</span> <span class="nx">u</span> <span class="o">!=</span> <span class="dl">""</span> <span class="p">?</span> <span class="nf">c</span><span class="p">(</span><span class="nx">u</span><span class="p">)</span> <span class="p">:</span> <span class="dl">""</span><span class="p">,</span> <span class="dl">""</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="dl">""</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">No default Consent settings found</span><span class="dl">"</span><span class="p">);</span>
<span class="p">})();</span>
</pre></td></tr></tbody></table></code></div></div>

<p><em>Source: <a href="https://support.cookiebot.com/hc/en-us/articles/360018413380-Checking-if-Consent-Mode-is-properly-implemented">Cookiebot</a></em></p>

<p>The above snippet will print something like this to the console. Feel free to modify it as needed to suit your needs:</p>

<p><a href="/gunnargriese.github.io/assets/img/consent-mode/google-tag-data-consent.png" class="popup img-link "><img data-src="/gunnargriese.github.io/assets/img/consent-mode/google-tag-data-consent.png" alt="google-tag-data-consent" class="lazyload" data-proofer-ignore></a>
<em>Source: Own GTM Setup</em></p>

<h3 id="using-the-network-tab"><span class="mr-2">Using the Network Tab</span><a href="#using-the-network-tab" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>As with every other part of the measurement setup, the Network tab is the source of truth when validating the Consent Mode v2 implementation. It allows you to inspect the requests and responses sent to and from Google’s servers - the data that is being dispatched by the browser -and verify that the consent state is being applied correctly to your tags.</p>

<h4 id="gcs-parameter"><span class="mr-2">gcs parameter</span><a href="#gcs-parameter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The <code class="language-plaintext highlighter-rouge">gcs</code>parameter has been around since Google Consent Mode v1 and is used to communicate the current consent state for <code class="language-plaintext highlighter-rouge">ad_storage</code> and <code class="language-plaintext highlighter-rouge">analytics_storage</code> to Google’s servers. So, the consent type signals to Google whether or not cookies have been used while obtaining the event data.</p>

<p>The <code class="language-plaintext highlighter-rouge">gcs</code> parameter is included in the requests sent to Google’s servers and contains the current consent state encoded in a binary format:</p>

<p><code class="language-plaintext highlighter-rouge">G1&lt;ad_storage [0/1]&gt;&lt;analytics_storage [0/1]&gt;</code></p>

<p>The parameter is used to signal to Google whether or not cookies have been used while obtaining the event data. See below for the possible values of the <code class="language-plaintext highlighter-rouge">gcs</code> parameter and their meanings:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Value</th>
      <th>Meaning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">G100</code></td>
      <td>Consent is denied for both <code class="language-plaintext highlighter-rouge">ad_storage</code> and <code class="language-plaintext highlighter-rouge">analytics_storage</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">G110</code></td>
      <td>Consent is granted for <code class="language-plaintext highlighter-rouge">ad_storage</code> and denied for <code class="language-plaintext highlighter-rouge">analytics_storage</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">G101</code></td>
      <td>Consent is denied for <code class="language-plaintext highlighter-rouge">ad_storage</code> and granted for <code class="language-plaintext highlighter-rouge">analytics_storage</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">G111</code></td>
      <td>Consent for both <code class="language-plaintext highlighter-rouge">ad_storage</code> and <code class="language-plaintext highlighter-rouge">analytics_storage</code> is granted.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">G1--</code></td>
      <td>The site did not require consent for <code class="language-plaintext highlighter-rouge">ad_storage</code> or <code class="language-plaintext highlighter-rouge">analytics_storage</code>.</td>
    </tr>
  </tbody>
</table></div>

<blockquote>
  <p>According to Google, the functionality and the format of the <code class="language-plaintext highlighter-rouge">gcs</code> query parameter remain as is, and Google has planned no changes to the parameter format.</p>
</blockquote>

<h4 id="gcd-parameter"><span class="mr-2">gcd parameter</span><a href="#gcd-parameter" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The <code class="language-plaintext highlighter-rouge">gcd</code> parameter is the new kid on the block, as it has been introduced with Consent Mode v2. It is primarily used to communicate the current consent state for <code class="language-plaintext highlighter-rouge">ad_user_data</code> and <code class="language-plaintext highlighter-rouge">ad_personalization</code> to Google’s servers. But the parameter also contains the information about the consent state for <code class="language-plaintext highlighter-rouge">ad_storage</code> and <code class="language-plaintext highlighter-rouge">analytics_storage</code>:</p>

<p><code class="language-plaintext highlighter-rouge">11&lt;ad_storage&gt;1&lt;analytics_storage&gt;1&lt;ad_user_data&gt;1&lt;ad_personalization&gt;5</code></p>

<p>Furthermore, the <code class="language-plaintext highlighter-rouge">gcd</code> parameter contains information about the current state and whether or not the current state was obtained from a default or an update command or never has been actively set. To convey all of this information in a single parameter, Google uses a base64-encoded format, where each letter represents a specific consent state and command type:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Letter</th>
      <th>Description</th>
      <th>Consent Status</th>
      <th>Command Type</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">p</code></td>
      <td>All types are denied in only default setting</td>
      <td>Denied</td>
      <td>Default</td>
      <td><code class="language-plaintext highlighter-rouge">l1p1p1p1p5</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">q</code></td>
      <td>All types are denied in default and update settings</td>
      <td>Denied</td>
      <td>Default &amp; Update</td>
      <td><code class="language-plaintext highlighter-rouge">l1q1q1q1q5</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">t</code></td>
      <td>All types are granted in only default setting</td>
      <td>Granted</td>
      <td>Default</td>
      <td><code class="language-plaintext highlighter-rouge">l1t1t1t1t5</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">r</code></td>
      <td>All types are denied in default setting but are granted in update setting</td>
      <td>Denied, then Granted</td>
      <td>Default, then Update</td>
      <td><code class="language-plaintext highlighter-rouge">l1r1r1r1r5</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">m</code></td>
      <td>All types are denied in only update setting (rare)</td>
      <td>Denied</td>
      <td>Update</td>
      <td><code class="language-plaintext highlighter-rouge">l1m1m1m1m5</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">n</code></td>
      <td>All types are granted in only update setting (rare)</td>
      <td>Granted</td>
      <td>Update</td>
      <td><code class="language-plaintext highlighter-rouge">l1n1n1n1n5</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">u</code></td>
      <td>All types are granted in default setting but are denied in update setting (rare)</td>
      <td>Granted, then Denied</td>
      <td>Default, then Update</td>
      <td><code class="language-plaintext highlighter-rouge">l1u1u1u1u5</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">v</code></td>
      <td>All types are granted in default and update settings (rare)</td>
      <td>Granted</td>
      <td>Default &amp; Update</td>
      <td><code class="language-plaintext highlighter-rouge">l1v1v1v1v5</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">l</code></td>
      <td>Consent type is missing (indicates no Consent Mode setting)</td>
      <td>Missing</td>
      <td>None</td>
      <td><code class="language-plaintext highlighter-rouge">l1l1l1l1l1</code></td>
    </tr>
  </tbody>
</table></div>

<p>As you can see, the <code class="language-plaintext highlighter-rouge">gcd</code>parameter is as cryptic as it gets. But having an understanding of the parameter and its values is crucial for validating the Consent Mode v2 implementation.</p>

<blockquote>
  <p>Huge shoutout to <strong>Markus Baersch</strong> for deciperhing the <code class="language-plaintext highlighter-rouge">gcd</code> parameter and making the information available to the community. For more information, see <a href="https://www.markus-baersch.de/blog/consent-mode-2-0-faq/">here</a>.</p>
</blockquote>

<h3 id="validating-the-consent-mode-v2-implementation-for"><span class="mr-2">Validating the Consent Mode v2 Implementation for</span><a href="#validating-the-consent-mode-v2-implementation-for" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Lastly, let’s have a look at how to validate and debug the Consent Mode v2 implementation for Firebase SDK on different platforms. That much I can tell you already: it is a bit more straightforward than for web, as you can use the debug console of <a href="https://developers.google.com/tag-platform/security/guides/app-consent?platform=ios#verify_consent_settings">Xcode</a> and <a href="https://developers.google.com/tag-platform/security/guides/app-consent?platform=android#verify_consent_settings">Android Studio</a> to verify the consent state.</p>

<h4 id="ios"><span class="mr-2">iOS</span><a href="#ios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>You can verify that your consent settings are working as intended by viewing the Xcode debug console for your app. To do so, you follow these steps:</p>

<ol>
  <li>Enable verbose logging on your device.</li>
  <li>In the Xcode debug console, look for the consent type names in console logs:</li>
</ol>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ad_storage</code></li>
  <li><code class="language-plaintext highlighter-rouge">analytics_storage</code></li>
  <li><code class="language-plaintext highlighter-rouge">ad_user_data</code></li>
  <li><code class="language-plaintext highlighter-rouge">ad_personalization</code></li>
</ul>

<p>For example, if <code class="language-plaintext highlighter-rouge">ad_storage</code> are enabled, you’ll see the following message: “ad_storage is granted.””</p>

<h4 id="android"><span class="mr-2">Android</span><a href="#android" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>You can verify that your consent settings are working as intended by viewing the log messages for your app. To do so, you follow these steps:</p>

<ol>
  <li>Enable verbose logging on your device.</li>
  <li>In the Android Studio logcat, find the log message that starts with “Setting consent”.</li>
</ol>

<p>For example, if <code class="language-plaintext highlighter-rouge">ad_storage</code> is enabled, you’ll see the following log message:</p>

<p><code class="language-plaintext highlighter-rouge">Setting consent, ... AD_STORAGE=granted</code></p>

<h2 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>In conclusion, the evolution of Consent Mode into its second iteration underlines its importance in ensuring the management of consent preferences for Google’s advertising universe.</p>

<p>It intends to allow users to navigate the digital space with increased autonomy, exercising more control over their data. Conversely, advertisers can benefit from a more refined approach to data collection that, if executed with precision and transparency. This can lead to a more trust-based relationship with their users.</p>

<p>The two new consent types introduced with Consent Mode v2 are mainly focused on controlling data activation processes, signaling a more granular level of data management for advertisers than ever before. The previously present consent types remain and focus on how the data is collected. The necessary adoption of Consent Mode v2 will be a manageable technical challenge for advertisers, as its implementation is relatively straightforward.</p>

<p>However, the introduction of Consent Mode v2 is not without its complexities (as indicated by the length of this blog post). As the advertising system created by Google and its legislation grows in sophistication, the burden of understanding and correctly implementing these new settings falls heavily on those who manage them - the advertisers.</p>

<p>MarTech providers such as Google should make it as simple as possible for advertisers to follow these standards - Google needs to give Consent Mode more love and work to do that.</p>

</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw mr-1"></i>
    
      <a href='/gunnargriese.github.io/categories/ga4/'>GA4</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw mr-1"></i>
      
      <a href="/gunnargriese.github.io/tags/ga4/"
          class="post-tag no-text-decoration" >ga4</a>
      
      <a href="/gunnargriese.github.io/tags/gtm/"
          class="post-tag no-text-decoration" >gtm</a>
      
      <a href="/gunnargriese.github.io/tags/gtm-server-side/"
          class="post-tag no-text-decoration" >gtm-server-side</a>
      
      <a href="/gunnargriese.github.io/tags/consent-mode/"
          class="post-tag no-text-decoration" >consent-mode</a>
      
      <a href="/gunnargriese.github.io/tags/firebase-analytics/"
          class="post-tag no-text-decoration" >firebase-analytics</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.

      
    </div>

    <!-- Post sharing snippet -->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    
    

    
      
      <a
        href="https://twitter.com/intent/tweet?text=Consent%20Mode%20v2%20-%20A%20Comprehensive%20Technical%20Guide%20-%20Gunnar%20Griese&url=http%3A%2F%2Flocalhost%3A4000%2Fgunnargriese.github.io%2Fposts%2Fconsent-mode-v2%2F"
        data-toggle="tooltip"
        data-placement="top"
        title="Twitter"
        target="_blank"
        rel="noopener"
        aria-label="Twitter"
      >
        <i class="fa-fw fab fa-twitter"></i>
      </a>
    
      
      <a
        href="https://www.facebook.com/sharer/sharer.php?title=Consent%20Mode%20v2%20-%20A%20Comprehensive%20Technical%20Guide%20-%20Gunnar%20Griese&u=http%3A%2F%2Flocalhost%3A4000%2Fgunnargriese.github.io%2Fposts%2Fconsent-mode-v2%2F"
        data-toggle="tooltip"
        data-placement="top"
        title="Facebook"
        target="_blank"
        rel="noopener"
        aria-label="Facebook"
      >
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    
      
      <a
        href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fgunnargriese.github.io%2Fposts%2Fconsent-mode-v2%2F&text=Consent%20Mode%20v2%20-%20A%20Comprehensive%20Technical%20Guide%20-%20Gunnar%20Griese"
        data-toggle="tooltip"
        data-placement="top"
        title="Telegram"
        target="_blank"
        rel="noopener"
        aria-label="Telegram"
      >
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <i
      id="copy-link"
      class="fa-fw fas fa-link small"
      data-toggle="tooltip"
      data-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
    </i>
  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
      
    </div>
  </div>
  <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted">
    <div class="access">
      














  <div id="access-lastmod" class="post">
    <div class="panel-heading">Recently Updated</div>
    <ul class="post-content pl-0 pb-1 ml-1 mt-2">
      
        
        
        
        <li>
          <a href="/gunnargriese.github.io/posts/confidential-matching/">Confidential Matching – A Breakthrough for Privacy-Conscious Advertising or a Temporary Fix?</a>
        </li>
      
        
        
        
        <li>
          <a href="/gunnargriese.github.io/posts/firebase-analytics-debugging/">Debugging Google Analytics Tracking for Mobile Apps - A Guide for Beginners</a>
        </li>
      
        
        
        
        <li>
          <a href="/gunnargriese.github.io/posts/ga4-time-travel-bridging-utc-and-local-timezones/">GA4 Time Travel - Bridging UTC and Local Timezones</a>
        </li>
      
        
        
        
        <li>
          <a href="/gunnargriese.github.io/posts/posthog-gtm-template/">Unleash the Potential of PostHog Analytics Platform with Google Tag Manager</a>
        </li>
      
        
        
        
        <li>
          <a href="/gunnargriese.github.io/posts/bigquery-path-exploration/">How to replicate the GA4 Path Exploration report with BigQuery SQL?</a>
        </li>
      
    </ul>
  </div>
  <!-- #access-lastmod -->


      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/ga4/">ga4</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/bigquery/">bigquery</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/gtm-server-side/">gtm-server-side</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/gtm/">gtm</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/sql/">sql</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/firebase-analytics/">firebase-analytics</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/charles-proxy/">charles-proxy</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/consent-mode/">consent-mode</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/custom-templates/">custom-templates</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/ios-debugger/">ios-debugger</a>
      
    </div>
  </div>


    </div>

    
      
      



  <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
    <div class="panel-heading pl-3 pt-2 mb-2">Contents</div>
    <nav id="toc"></nav>
  </div>

  <!-- toc.js will be loaded at medium priority -->
  <script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script>


    
  </div>
</div>

<!-- tail -->

  <div class="row">
    <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5">
      
        
        <!--
  Recommend the other 3 posts according to the tags and categories of the current post,
  if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->








  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  






<!-- Fill with the other newlest posts -->





  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3
      class="pt-2 mb-4 ml-1"
      data-toc-skip
    >
      Further Reading
    </h3>
    <div class="card-deck mb-4">
      
        
        
        <div class="card">
          <a href="/gunnargriese.github.io/posts/firebase-analytics-debugging/">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class="small"
  data-ts="1683278655"
  data-df="DD/MM/YYYY"
  
>
  05/05/2023
</em>

              <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Debugging Google Analytics Tracking for Mobile Apps - A Guide for Beginners</h3>
              <div class="text-muted small">
                <p>
                  





                  Are you a digital analyst looking to implement and debug Google Analytics tracking via Firebase for your mobile iOS apps and have no clue where to start? This blog post is for you! I’ll briefly wal...
                </p>
              </div>
            </div>
          </a>
        </div>
      
        
        
        <div class="card">
          <a href="/gunnargriese.github.io/posts/gtm-server-side/">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class="small"
  data-ts="1598016255"
  data-df="DD/MM/YYYY"
  
>
  21/08/2020
</em>

              <h3 class="pt-0 mt-1 mb-3" data-toc-skip>GTM Server-Side Tagging – Better Data & More Control</h3>
              <div class="text-muted small">
                <p>
                  





                  Over the last many months we have been running a series of beta tests and projects for a group of selected clients to get both practical experience and to help optimize the recently released Google...
                </p>
              </div>
            </div>
          </a>
        </div>
      
        
        
        <div class="card">
          <a href="/gunnargriese.github.io/posts/ga4-the-cdp-you-didnt-know-you-had/">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class="small"
  data-ts="1691835255"
  data-df="DD/MM/YYYY"
  
>
  12/08/2023
</em>

              <h3 class="pt-0 mt-1 mb-3" data-toc-skip>GA4 - The CDP You Didn't Know You Had</h3>
              <div class="text-muted small">
                <p>
                  





                  This article is a write-up of my talk at MeasureCamp Czechia in Prague in September 2023 - thanks to everyone who attended the session and provided feedback.

I’ll explore how Google Analytics 4 (G...
                </p>
              </div>
            </div>
          </a>
        </div>
      
    </div>
    <!-- .card-deck -->
  </div>
  <!-- #related-posts -->


      
        
        <!-- Navigation buttons at the bottom of the post. -->

<div class="post-navigation d-flex justify-content-between">
  
    <a
      href="/gunnargriese.github.io/posts/ga4-data-redaction/"
      class="btn btn-outline-primary"
      prompt="Older"
    >
      <p>GA4 Client-Side Data Redaction - How to remove PII from your data before you collect it</p>
    </a>
  

  
    <a
      href="/gunnargriese.github.io/posts/ga4-conversions-to-bigquery/"
      class="btn btn-outline-primary"
      prompt="Newer"
    >
      <p>Mapping GA4 Conversions in BigQuery for Comprehensive Dashboarding</p>
    </a>
  
</div>

      
        
        <!--  The comments switcher -->

  
  <!-- The Disqus lazy loading. -->
<div id="disqus_thread" class="pt-2 pb-2">
  <p class="text-center text-muted small">Comments powered by <a href="https://disqus.com/">Disqus</a>.</p>
</div>

<script type="text/javascript">
  var disqus_config = function () {
    this.page.url = 'http://localhost:4000/gunnargriese.github.io/posts/consent-mode-v2/';
    this.page.identifier = '/posts/consent-mode-v2/';
  };

  /* Lazy loading */
  var disqus_observer = new IntersectionObserver(
    function (entries) {
      if (entries[0].isIntersecting) {
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = 'https://gunnargriese-com.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();

        disqus_observer.disconnect();
      }
    },
    { threshold: [0] }
  );

  disqus_observer.observe(document.querySelector('#disqus_thread'));

  /* Auto switch theme */
  function reloadDisqus() {
    if (event.source === window && event.data && event.data.direction === ModeToggle.ID) {
      /* Disqus hasn't been loaded */
      if (typeof DISQUS === 'undefined') {
        return;
      }

      if (document.readyState == 'complete') {
        DISQUS.reset({ reload: true, config: disqus_config });
      }
    }
  }

  if (document.querySelector('.mode-toggle')) {
    window.addEventListener('message', reloadDisqus);
  }
</script>



      
    </div>
  </div>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">Trending Tags</div>
    <div class="d-flex flex-wrap mt-3 mb-1 mr-3">
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/ga4/">ga4</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/bigquery/">bigquery</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/gtm-server-side/">gtm-server-side</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/gtm/">gtm</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/sql/">sql</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/firebase-analytics/">firebase-analytics</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/charles-proxy/">charles-proxy</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/consent-mode/">consent-mode</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/custom-templates/">custom-templates</a>
      
        
        <a class="post-tag" href="/gunnargriese.github.io/tags/ios-debugger/">ios-debugger</a>
      
    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

    </div>
    <!-- #main-wrapper -->

    <!-- The Footer -->

<footer>
    <div class="container pl-lg-4 pr-lg-4">
        <div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3">
            <div class="footer-left">
                <p class="mb-0">
                    © 2024
                    <a href="https://github.com/GunnarGriese">Gunnar Griese</a>. 
                    <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span> 
                </p>
            </div>

            <div class="footer-right">
                <p class="mb-0"><!-- 
          Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.
          -->
                </p>
            </div>
        </div>
    </div>
</footer>

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/gunnargriese.github.io/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5"></p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!-- JS selector for site. -->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup & clipboard -->
  

  







  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js"></script>





  

  

  







  
    

    

  



  
    

    

  



  
    

    

  



  
    

    

  




  <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1.11.6/dayjs.min.js,npm/dayjs@1.11.6/locale/.min.js,npm/dayjs@1.11.6/plugin/relativeTime.min.js,npm/dayjs@1.11.6/plugin/localizedFormat.min.js"></script>







<script defer src="/gunnargriese.github.io/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>



  </body>
</html>

